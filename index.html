<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
  <title>SHADE RADIO – Live</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* ── RESET & BASE ── */
    * { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    /* FIX IOS : On empêche le scroll sur le body pour éviter que la page entière bouge */
    html, body { 
      background: #000; 
      height: 100%; 
      overflow: hidden; 
      position: fixed; 
      width: 100%;
    }

    body::before { content: ""; position: fixed; inset: 0; background: radial-gradient(circle at 50% 40%, rgba(220,0,0,0.55), transparent 65%), radial-gradient(circle at 80% 90%, rgba(150,0,0,0.3), transparent 50%), radial-gradient(circle at 10% 20%, rgba(80,0,0,0.4), transparent 40%); z-index: -1; pointer-events: none; }

    /* ── LAYOUT ── */
    #app { width: 100%; max-width: 420px; display: flex; flex-direction: column; align-items: center; height: 100%; margin: 0 auto; }

    /* ... (Tes styles TOP BAR, HAMBURGER, MAIN FRAME restent identiques) ... */
    .top-bar { display: flex; align-items: center; gap: 10px; width: 100%; padding: 10px 15px; }
    .header-container { flex: 1; display: flex; align-items: center; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 12px; overflow: hidden; }
    .live-badge { background: linear-gradient(90deg, #ff0000, #8b0000); color: #fff; font-size: 11px; font-weight: bold; padding: 10px 12px; animation: pulse 1.5s infinite; white-space: nowrap; }
    .radio-ticker { flex: 1; overflow: hidden; padding: 8px 0; display: flex; }
    .radio-ticker span { display: inline-block; white-space: nowrap; padding-left: 100%; animation: scroll-text 12s linear infinite; color: #fff; font-size: 11px; font-weight: 600; text-transform: uppercase; }
    @keyframes scroll-text { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    .hamburger-btn { cursor: pointer; background: rgba(180,0,0,0.25); padding: 8px 10px; border-radius: 10px; backdrop-filter: blur(10px); border: 1px solid rgba(255,0,0,0.4); display: flex; flex-direction: column; justify-content: center; transition: 0.3s; box-shadow: 0 0 15px rgba(255,0,0,0.2); flex-shrink: 0; position: relative; }
    .hamburger-btn span { display: block; width: 22px; height: 2px; background: #fff; margin: 3px 0; border-radius: 2px; transition: 0.4s; }
    .hamburger-btn.open span:nth-child(1) { transform: rotate(-45deg) translate(-5px, 6px); }
    .hamburger-btn.open span:nth-child(2) { opacity: 0; }
    .hamburger-btn.open span:nth-child(3) { transform: rotate(45deg) translate(-5px, -6px); }
    #chatBadge { position: absolute; top: -6px; right: -6px; background: #ff0000; color: #fff; font-size: 10px; font-weight: bold; min-width: 18px; height: 18px; border-radius: 9px; display: none; align-items: center; justify-content: center; padding: 0 4px; border: 2px solid #000; z-index: 10; }
    .main-frame { background: linear-gradient(180deg, rgba(120,0,0,0.18) 0%, rgba(255,255,255,0.03) 100%); backdrop-filter: blur(20px); border-radius: 50px; padding: 25px 10px 220px 10px; margin-top: 5px; width: 92%; max-width: 340px; position: relative; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 40px 80px rgba(0,0,0,0.9), inset 0 0 20px rgba(255,0,0,0.1); }
    .radio-logo { width: 290px; margin: 0 auto 5px; display: block; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.8)) drop-shadow(0 0 20px rgba(255,0,0,0.3)); animation: logo-swing 7s ease-in-out infinite; }
    .player-container { position: relative; width: 100%; display: flex; justify-content: center; margin-top: 15px; }
    #sc-player { background: transparent !important; transform: scale(0.65); transform-origin: top center; height: 300px; position: relative; z-index: 2; }
    .custom-vinyl { position: absolute; top: 191px; width: 155px; height: 155px; z-index: 1; animation: vinyl-spin 6s linear infinite; }
    .ad-banner { position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 10px; overflow: hidden; display: flex; }
    .ad-ticker { flex: 1; padding: 7px 0; overflow: hidden; display: flex; }
    .ad-ticker span { display: inline-block; white-space: nowrap; padding-left: 100%; animation: scroll-text 14s linear infinite; color: #fff; font-size: 10px; font-weight: 500; text-transform: uppercase; }

    /* ── OVERLAYS MODIFIÉS ── */
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%; 
      height: 100dvh;
      backdrop-filter: blur(25px) saturate(150%);
      -webkit-backdrop-filter: blur(25px) saturate(150%);
      background: rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      visibility: hidden;
      z-index: 1000;
    }
    .overlay.open { visibility: visible; }

    /* ── CHAT SPECIFIQUE ── */
    #chatOverlay {
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.1, 0.7, 0.1, 1);
    }
    #chatOverlay.open { transform: translateY(0); }

    .chat-header { flex-shrink: 0; padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); }
    
    .chat-body {
      flex: 1;
      display: none;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }
    .chat-body.show { display: flex; }

    .messages-list {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      padding-bottom: 80px; /* Espace pour la barre fixe */
      -webkit-overflow-scrolling: touch;
    }

    /* FIX IOS : Barre de saisie fixée en bas du viewport */
    .chat-input-row {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      padding-bottom: max(12px, env(safe-area-inset-bottom));
      background: rgba(20, 20, 20, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,0.1);
      z-index: 1100;
      transition: transform 0.1s ease-out; /* Pour suivre le clavier de manière fluide */
    }

    .chat-input { 
      flex: 1; 
      padding: 12px 18px; 
      border-radius: 25px; 
      border: 1px solid rgba(255,255,255,0.2); 
      background: rgba(255,255,255,0.1); 
      color: #fff; 
      font-size: 16px; /* 16px minimum pour éviter le zoom auto sur iPhone */
      outline: none; 
    }

    /* ... (Reste des styles de bulles et boutons identiques) ... */
    .bubble-wrap { display: flex; flex-direction: column; max-width: 76%; margin-bottom: 10px; }
    .bubble-wrap.me { align-self: flex-end; }
    .bubble-wrap.them { align-self: flex-start; }
    .bubble { padding: 10px 14px; border-radius: 18px; font-size: 14px; color: #fff; }
    .bubble-wrap.me .bubble { background: linear-gradient(135deg, #ff0000, #8b0000); border-bottom-right-radius: 4px; }
    .bubble-wrap.them .bubble { background: rgba(255,255,255,0.15); border-bottom-left-radius: 4px; }
    .send-btn { background: #ff0000; border: none; width: 44px; height: 44px; border-radius: 50%; color: #fff; cursor: pointer; }

  </style>
</head>
<body>

  <div id="app">
    <div class="top-bar">
        <div class="header-container"><div class="live-badge">● LIVE</div></div>
        <div class="hamburger-btn" onclick="toggleMenu()"><span></span><span></span><span></span></div>
    </div>
    <div class="main-frame">
        <img src="assets/logo2.PNG" class="radio-logo">
        <p style="color:white; text-align:center;">Appuyez sur le menu pour le chat</p>
    </div>
  </div>

  <div class="overlay" id="menuOverlay" style="justify-content:center; align-items:center; gap:20px;">
      <button onclick="openChat()" style="padding:15px 30px; border-radius:30px; border:none; background:red; color:white; font-weight:bold;">OUVRIR CHAT</button>
      <button onclick="toggleMenu()" style="color:white; background:none; border:none;">Fermer</button>
  </div>

  <div class="overlay" id="chatOverlay">
    <div class="chat-header">
      <div style="color:white; font-weight:bold;">Chat Auditeurs</div>
      <button onclick="closeChat()" style="background:none; border:none; color:white; font-size:20px;">✕</button>
    </div>

    <div class="pseudo-screen" id="pseudoScreen" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; gap:20px;">
        <h2 style="color:white;">Ton Pseudo</h2>
        <input id="pseudoInput" class="pseudo-input" style="padding:10px; border-radius:10px;" placeholder="Pseudo...">
        <button onclick="joinChat()" style="padding:10px 20px; background:red; color:white; border:none; border-radius:10px;">Entrer</button>
    </div>

    <div class="chat-body" id="chatBody">
      <div class="messages-list" id="messagesList">
          </div>
      
      <div class="chat-input-row" id="chatInputRow">
        <input class="chat-input" id="msgInput" type="text" placeholder="Ton message..." maxlength="200" autocomplete="off">
        <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>

  <script>
    // --- Logique de base ---
    var myPseudo = null;

    function toggleMenu() { document.getElementById('menuOverlay').classList.toggle('open'); }
    function openChat() { 
        document.getElementById('menuOverlay').classList.remove('open');
        document.getElementById('chatOverlay').classList.add('open'); 
    }
    function closeChat() { document.getElementById('chatOverlay').classList.remove('open'); }
    
    function joinChat() {
        myPseudo = document.getElementById('pseudoInput').value;
        if(myPseudo) {
            document.getElementById('pseudoScreen').style.display = 'none';
            document.getElementById('chatBody').classList.add('show');
            fixIOSKeyboard(); // Activation du correcteur IOS
        }
    }

    function sendMessage() {
        var val = document.getElementById('msgInput').value;
        if(!val) return;
        var list = document.getElementById('messagesList');
        var div = document.createElement('div');
        div.className = "bubble-wrap me";
        div.innerHTML = `<div class="bubble">${val}</div>`;
        list.appendChild(div);
        document.getElementById('msgInput').value = "";
        list.scrollTop = list.scrollHeight;
    }

    /* ============================================================
       LE FIX IOS : GESTION DU CLAVIER VISUEL
    ============================================================ */
    function fixIOSKeyboard() {
        if (!window.visualViewport) return;

        const inputRow = document.getElementById('chatInputRow');
        const messagesList = document.getElementById('messagesList');

        window.visualViewport.addEventListener('resize', () => {
            // Calculer la hauteur du clavier
            // offsetTop donne la distance entre le haut du viewport et le haut du clavier
            const keyboardHeight = window.innerHeight - window.visualViewport.height;
            
            if (keyboardHeight > 50) {
                // Le clavier est ouvert : on remonte la barre
                // On utilise transform pour éviter les problèmes de layout saccadés
                inputRow.style.transform = `translateY(-${keyboardHeight}px)`;
                
                // Petit délai pour scroller en bas et voir le dernier message
                setTimeout(() => {
                    messagesList.scrollTop = messagesList.scrollHeight;
                }, 100);
            } else {
                // Le clavier est fermé
                inputRow.style.transform = `translateY(0)`;
            }
        });

        // Empêcher le scroll du body quand on touche la barre de saisie
        inputRow.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
    }

    // Sécurité supplémentaire pour iPhone
    document.addEventListener('focusin', (e) => {
        if (e.target.tagName === 'INPUT') {
            // Force le scroll à 0 sur le body pour contrer le comportement auto d'iOS
            window.scrollTo(0, 0);
            document.body.scrollTop = 0;
        }
    });
  </script>
</body>
</html>
